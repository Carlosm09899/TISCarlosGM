 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventas BD</title>
</head>
<body>

    <a href="./../Submodulos/Ventas.html">[Ventas]</a>

    <h1>Diseño de la base de datos del subsistema de Ventas</h1>

    <br>

    <h1>Diagrama de la base de datos</h1>
    <img src="./../Imagenes/Diagrama_Ventas.png" alt="Diagrama de la base de datos" width="800">

    <h1>Justificación del Diseño de la Base de Datos</h1>

    <h2>Tabla Ventas</h2>
    <h3>Propósito</h3>
    <p>Es la tabla principal su propósito es guardar la información general de una venta, como cuándo se realizó, quién la atendió y los montos totales. Funciona como el "recibo" principal al que se conectan todos los demás detalles.</p>
    <h3>Campos</h3>
    <ul>
        <li>ID_Venta: Es el identificador único (folio) para cada venta.</li>
        <li>Fecha_Hora_Venta: Guarda la fecha y hora exactas en que se realizó la transacción.</li>
        <li>Subtotal: Almacena la suma de los precios de todos los productos antes de descuentos e impuestos.</li>
        <li>Descuento_Total: Guarda el monto total que se descontó en la venta.</li>
        <li>Impuestos_Total: Almacena la suma total de impuestos (IVA, ISH, etc.).</li>
        <li>Total_Venta: Es el monto final que el cliente debe pagar (Subtotal - Descuento_Total + Impuestos_Total).</li>
        <li>ID_Empleado: Conecta con la tabla de Empleados para saber qué empleado realizó la venta.</li>
        <li>ID_Habitacion_Asociada: Conecta con Habitaciones para cargar el consumo a un cuarto específico. Puede ser opcional.</li>
        <li>ID_Cliente_Miembro: Conecta con Clientes para identificar si la compra fue hecha por un miembro registrado y aplicar beneficios.</li>
        <li>ID_Estado_Pago: Conecta con la tabla Estados_Pago para saber si la venta está pagada, pendiente o cancelada.</li>
    </ul>
    
    <h2>Tabla Detalle_Ventas</h2>
    <h3>Propósito</h3>
    <p>Su propósito es registrar cada uno de los productos o servicios que se incluyeron en una venta. Es el "cuerpo" del recibo, donde se desglosa lo que el cliente compró. Una venta puede tener muchos detalles.</p>
    <h3>Campos</h3>
    <ul>
        <li>ID_Detalle_Venta: Es el identificador único para cada línea o renglón de la venta.</li>
        <li>ID_Venta: Conecta cada producto con la venta a la que pertenece.</li>
        <li>Descripcion_Concepto: Guarda el nombre o descripción del producto/servicio en el momento de la venta.</li>
        <li>Cantidad: Indica cuántas unidades del producto o servicio se compraron.</li>
        <li>Precio_Unitario: Almacena el precio de una sola unidad del producto en el momento de la venta.</li>
        <li>Monto_Descuento_Aplicado: Guarda el descuento específico para esa línea de producto, si lo hubo.</li>
        <li>ID_Producto_Servicio: Conecta con la tabla de Servicios para identificar el producto o servicio vendido.</li>
        <li>ID_Promocion_Aplicada: Conecta con Promociones para saber si se aplicó una promoción específica a este producto.</li>
    </ul>
    
    <h2>Tabla Pagos</h2>
    <h3>Propósito</h3>
    <p>Esta tabla registra cómo se liquidó la venta. Su propósito es llevar un control de las entradas de dinero, permitiendo que una sola venta se pueda pagar con múltiples métodos (ej. una parte en efectivo y otra con tarjeta).</p>
    <h3>Campos</h3>
    <ul>
        <li>ID_Pago: Es el identificador único para cada transacción de pago.</li>
        <li>ID_Venta: Conecta el pago con la venta que está saldando.</li>
        <li>Fecha_Hora_Pago: Guarda la fecha y hora exactas en que se recibió el dinero.</li>
        <li>Monto_Recibido: Almacena la cantidad de dinero que se recibió en esta transacción.</li>
        <li>Cambio_Entregado: Guarda el cambio que se le devolvió al cliente.</li>
        <li>Referencia_Pago: Almacena códigos de referencia, como el número de autorización de una tarjeta de crédito.</li>
        <li>ID_Metodo_Pago: Conecta con la tabla Metodos_Pago para saber cómo se pagó (efectivo, tarjeta, etc.).</li>        
    </ul>
    
    <h2>Tabla Facturas</h2>
    <h3>Propósito</h3>
    <p>Su propósito es almacenar la información fiscal de una venta cuando el cliente solicita una factura. Se mantiene separada porque no todas las ventas se facturan.</p>
    <h3>Campos</h3>
    <ul>
        <li>ID_Factura: Es el identificador único del documento fiscal.</li>
        <li>ID_Venta: Conecta la factura con la venta de origen.</li>
        <li>Fecha_Emision: Indica la fecha y hora en que se generó la factura.</li>
        <li>RFC: Guarda el Registro Federal de Contribuyentes del cliente.</li>
        <li>Razon_Social: Almacena el nombre o razón social del cliente a facturar.</li>
        <li>Correo_Facturacion: Guarda el email a donde se enviará la factura.</li>
        <li>ID_Estado_Factura: Conecta con Estados_Factura para saber el estatus del documento (generada, enviada, cancelada).</li>
    </ul>

    <h2>Tabla Catálogo</h2>
    <h3>Propósito</h3>
    <p>El propósito de las siguientes tablas es estandarizar la información para evitar errores y mantener la consistencia en toda la base de datos. Funcionan como "menús de opciones".</p>
    <h3>Campos</h3>
    <ul>
        <h3>Tabla Metodos_Pago</h3>
        <li>ID_Metodo_Pago: Identificador único del método.</li>
        <li>Nombre_Metodo: El nombre del método de pago (ej. "Efectivo", "Tarjeta de Crédito", "Transferencia").</li>
        <h3>Tabla Estados_Pago</h3>
        <li>ID_Estado_Pago: Identificador único del estado.</li>
        <li>Nombre_Estado: El nombre del estado de la venta (ej. "Pagada", "Pendiente", "Cancelada").</li>
        <h3>Tabla Estados_Factura</h3>
        <li>ID_Estado_Factura: Identificador único del estado.</li>
        <li>Nombre_Estado: El nombre del estado de la factura (ej. "Generada", "Enviada al cliente", "Cancelada ante el SAT").</li>
    </ul>

    <p>La estructura de la base de datos está diseñada para asegurar que el sistema opere con datos confiables y funcione sin fallos, todo centrado en las necesidades de sus usuarios y administradores.</p>
    
    <h2>Normalización de la Base de Datos</h2>
    <p>Para asegurar que los datos estén bien organizados y sean consistentes, la base de datos se estructuró siguiendo las tres primeras formas normales (1FN, 2FN y 3FN).</p>

    <h3>1NF (Primera Forma Normal)</h3>
    <p>Cada tabla tiene una clave primaria única para identificar cada registro, y todas las columnas son atómicas, lo que significa que cada campo almacena un solo valor y no una lista o conjunto de valores.</p>
    <ul>
        <li><b>Tabla Ventas</b>: Tiene ID_Venta como su clave primaria única. Todos sus campos, como Fecha_Hora_Venta y Total_Venta, almacenan un solo dato.</li>
        <li><b>Tabla Detalle_Ventas</b>: Es un ejemplo clave de la 1NF. En lugar de tener una columna en Ventas con una lista de productos, se creó esta tabla donde cada fila representa un único producto comprado en esa venta, garantizando así la atomicidad.</li>
        <li><b>Tablas de Catálogo (Metodos_Pago, Estados_Pago, Estados_Factura)</b>: Cada una tiene su propia clave primaria simple. Sus campos son atómicos, ya que cada registro representa una única entidad: un método de pago, un estado, etc.</li>
    </ul>

    <h3>2NF (Segunda Forma Normal)</h3>
    <p>Esta forma requiere que la tabla esté en 1NF y que todos los atributos que no forman parte de la clave primaria dependan completamente de la clave primaria completa, no solo de una parte de ella. Es especialmente relevante para tablas con claves compuestas.</p>
    <ul>
        <li><b>Todas las tablas del diseño (Ventas, Detalle_Ventas, Pagos, etc.)</b>: Cumplen automáticamente con la 2NF. La razón es que sus claves primarias son simples (formadas por una sola columna). La 2NF se enfoca en eliminar dependencias parciales en claves compuestas, y al no existir claves de ese tipo en este diseño, no hay posibilidad de este tipo de dependencia.</li>
    </ul>

    <h3>3NF (Tercera Forma Normal)</h3>
    <p>Para cumplir con la 3NF, la tabla debe estar en 2NF y ningún atributo que no sea clave puede depender de otro atributo que tampoco sea clave. Esto elimina las dependencias indirectas (transitivas).</p>
    <ul>
        <li><b>Tabla Facturas</b>: Cumple con la 3NF porque los datos fiscales se separaron de la tabla Ventas. La Razon_Social de un cliente depende de su RFC, no directamente de la ID_Venta. Al crear una tabla Facturas, se elimina esta dependencia transitiva y se evita almacenar información redundante o nula en la tabla principal de ventas.</li>
        <li><b>Tabla Ventas</b>:  Cumple con la 3NF porque todos sus campos (como Total_Venta o ID_Empleado) dependen directamente y exclusivamente de ID_Venta y no de otros campos no clave dentro de la misma tabla.</li>
        <li><b>Tablas de Catálogo (Metodos_Pago, etc.)</b>:  Cumplen de forma natural. En la tabla Metodos_Pago, el campo Nombre_Metodo depende únicamente de ID_Metodo_Pago, eliminando cualquier posibilidad de dependencias transitivas</li>
    </ul>    
    


    <h1>Código SQL para crear tablas</h1>
    <pre><code>
CREATE DATABASE SERVICIOS

-- --- Tabla de Categorías ---
CREATE TABLE Categorias (
    ID_Categoria INT IDENTITY(1,1) PRIMARY KEY,
    Nombre_Categoria VARCHAR(100) NOT NULL UNIQUE,
    Descripcion_Categoria TEXT
);

-- --- Tabla de Estados ---
CREATE TABLE Estados (
    ID_Estado INT IDENTITY(1,1) PRIMARY KEY,
    Nombre_Estado VARCHAR(50) NOT NULL UNIQUE
);

-- --- Tabla de Tipos de Control de Stock ---
CREATE TABLE Tipos_Control_Stock (
    ID_Tipo_Control INT IDENTITY(1,1) PRIMARY KEY,
    Nombre_Control VARCHAR(100) NOT NULL UNIQUE
);

-- --- Tabla Principal de Servicios ---
CREATE TABLE Servicios ( 
    ID_Servicio INT IDENTITY(1,1) PRIMARY KEY,
    Nombre_Servicio VARCHAR(200) NOT NULL,
    Descripcion_Detallada TEXT,
    
    Precio_Venta DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    Costo_Adquisicion DECIMAL(10, 2) DEFAULT 0.00,
    Impuestos_Aplicables DECIMAL(4, 2) DEFAULT 0.16,
    
    Stock_Actual INT,
    Stock_Minimo INT,
    
    Imagen_Referencia VARCHAR(255),
    Horario_Disponibilidad VARCHAR(255),
    
    -- Claves Foráneas que conectan con las tablas catálogo
    ID_Categoria INT,
    ID_Estado INT,
    ID_Tipo_Control INT,
    
    -- Definición de las restricciones de las claves foráneas
    FOREIGN KEY (ID_Categoria) REFERENCES Categorias(ID_Categoria),
    FOREIGN KEY (ID_Estado) REFERENCES Estados(ID_Estado),
    FOREIGN KEY (ID_Tipo_Control) REFERENCES Tipos_Control_Stock(ID_Tipo_Control)
);


    </code></pre>


    <h1>Código SQL para agregar registros a las tablas</h1>

    <h3>Registro de Categorias</h3>
    <pre><code>
    INSERT INTO Categorias (Nombre_Categoria, Descripcion_Categoria) VALUES
    ('Masajes Corporales', 'Servicios de masajes para relajación y terapia.'),
    ('Tratamientos Faciales', 'Limpieza e hidratación para el cuidado de la piel del rostro.'),
    ('Venta de Productos', 'Productos de belleza y cuidado personal disponibles para compra.'),
    ('Peluquería y Estilismo', 'Cortes de cabello, peinados y tratamientos capilares.'),
    ('Manicura y Pedicura', 'Cuidado y embellecimiento de uñas, manos y pies.'),
    ('Rituales de Spa', 'Experiencias completas que combinan varios tratamientos.'),
    ('Paquetes y Membresías', 'Conjunto de servicios o accesos por un precio especial.'),
    ('Gimnasio y Fitness', 'Acceso a instalaciones y clases de acondicionamiento físico.'),
    ('Restaurante y Gastronomía', 'Servicios de alimentos y bebidas en nuestras instalaciones.'),
    ('Bar y Coctelería', 'Bebidas y aperitivos en un ambiente relajado.'),
    ('Eventos y Banquetes', 'Renta de espacios y servicios para eventos especiales.'),
    ('Transporte Ejecutivo', 'Servicio de transporte privado para huéspedes.'),
    ('Experiencias Románticas', 'Paquetes diseñados para parejas.'),
    ('Tours y Actividades', 'Excursiones y actividades recreativas organizadas por el hotel.'),
    ('Servicios Empresariales', 'Renta de salas de juntas y equipo de oficina.');
    GO
    </code></pre>

    <h3>Registro de Estados</h3>
    <pre><code>
    ('Activo'),               
    ('Inactivo'),             
    ('Agotado'),              
    ('Próximamente'),         
    ('Descontinuado'),        
    ('En Mantenimiento'),     
    ('Bajo Pedido'),          
    ('En Promoción'),         
    ('Reservado'),            
    ('Oculto'),               
    ('Borrador'),             
    ('Requiere Aprobación'),  
    ('Exclusivo Miembros'),   
    ('Temporalmente Suspendido'), 
    ('Disponible Online');  
    GO 
    </code></pre>

    <h3>Registro de Tipos_Control_Stock</h3>
    <pre><code>
    INSERT INTO Tipos_Control_Stock (Nombre_Control) VALUES
    ('Por Unidad'),           
    ('Por Sesión'),           
    ('No Aplica'),            
    ('Por Litro/Mililitro'),  
    ('Por Gramo/Kilogramo'),  
    ('Por Hora'),             
    ('Por Día'),              
    ('Por Persona'),          
    ('Por Paquete'),          
    ('Uso Interno'),          
    ('Digital/Descargable'),  
    ('Por Reservación'),      
    ('Por Metro Cuadrado'),   
    ('Por Kilómetro'),        
    ('Por Grupo');            
    GO
    </code></pre>

        <h3>Registro de Servicios</h3>
    <pre><code>
    INSERT INTO Servicios (Nombre_Servicio, Descripcion_Detallada, Precio_Venta, Costo_Adquisicion, Stock_Actual, Stock_Minimo, Horario_Disponibilidad, ID_Categoria, ID_Estado, ID_Tipo_Control) VALUES
    ('Masaje Tejido Profundo', '80 minutos de masaje intenso para liberar tensión muscular crónica.', 1200.00, 80.00, 100, 0, 'L-D 9:00-21:00', 1, 1, 2), -- Cat: Masajes, Est: Activo, Ctrl: Por Sesión
    ('Facial de Hidratación con Ácido Hialurónico', 'Tratamiento facial para pieles secas y deshidratadas.', 1100.00, 150.00, 100, 0, 'L-S 10:00-19:00', 2, 1, 2), -- Cat: Faciales, Est: Activo, Ctrl: Por Sesión
    ('Kit de Viaje Esencial', 'Incluye shampoo, acondicionador y crema corporal de 100ml.', 750.00, 400.00, 50, 10, '24/7 en recepción', 3, 1, 1), -- Cat: Productos, Est: Activo, Ctrl: Por Unidad
    ('Corte y Estilizado para Dama', 'Incluye lavado, corte con estilista senior y secado.', 900.00, 50.00, 100, 0, 'M-S 11:00-20:00', 4, 1, 2), -- Cat: Peluquería, Est: Activo, Ctrl: Por Sesión
    ('Pedicura Spa de Lujo', 'Incluye exfoliación, masaje y esmalte de larga duración.', 650.00, 70.00, 100, 0, 'M-S 11:00-20:00', 5, 8, 2), -- Cat: Manicura, Est: En Promoción, Ctrl: Por Sesión
    ('Ritual Holístico de Renovación', 'Experiencia de 3 horas con exfoliación, envoltura corporal y masaje.', 3500.00, 400.00, 50, 0, 'Previa reservación', 6, 1, 12), -- Cat: Rituales, Est: Activo, Ctrl: Por Reservación
    ('Membresía Gimnasio Mensual', 'Acceso ilimitado a todas las áreas del gimnasio y clases grupales.', 1500.00, 100.00, 500, 0, 'L-D 6:00-23:00', 7, 13, 1), -- Cat: Paquetes, Est: Exclusivo Miembros, Ctrl: Por Unidad
    ('Acceso de Día a Gimnasio', 'Day-pass para uso de instalaciones de fitness.', 350.00, 10.00, 1000, 0, 'L-D 6:00-23:00', 8, 1, 7), -- Cat: Gimnasio, Est: Activo, Ctrl: Por Día
    ('Cena Degustación 5 Tiempos', 'Menú especial del chef con maridaje opcional.', 1800.00, 700.00, 40, 0, 'J-S 19:00-23:00', 9, 1, 8), -- Cat: Restaurante, Est: Activo, Ctrl: Por Persona
    ('Clase de Mixología', 'Aprende a preparar 3 cócteles de autor con nuestro bartender experto.', 800.00, 150.00, 20, 0, 'Viernes 18:00', 10, 1, 8), -- Cat: Bar, Est: Activo, Ctrl: Por Persona
    ('Renta Salón "Primavera" por día', 'Salón para eventos con capacidad para 100 personas.', 25000.00, 2000.00, 1, 0, 'Previa reservación', 11, 7, 12), -- Cat: Eventos, Est: Bajo Pedido, Ctrl: Por Reservación
    ('Traslado Aeropuerto-Hotel en SUV', 'Servicio de transporte privado para hasta 4 personas.', 1600.00, 600.00, 10, 0, '24/7 con reservación', 12, 1, 12), -- Cat: Transporte, Est: Activo, Ctrl: Por Reservación
    ('Paquete "Noche Romántica"', 'Incluye botella de vino espumoso, fresas con chocolate y decoración.', 1300.00, 500.00, 50, 5, 'Previa reservación', 13, 1, 9), -- Cat: Experiencias, Est: Activo, Ctrl: Por Paquete
    ('Tour a las Pirámides de Teotihuacán', 'Excursión de día completo con guía certificado y transporte.', 2200.00, 1500.00, 30, 0, 'Miércoles y Sábados', 14, 4, 8), -- Cat: Tours, Est: Próximamente, Ctrl: Por Persona
    ('Renta de Sala de Juntas por Hora', 'Espacio para 8 personas con proyector y servicio de café.', 950.00, 100.00, 10, 0, 'L-V 8:00-19:00', 15, 1, 6); -- Cat: Empresarial, Est: Activo, Ctrl: Por Hora
    GO
    </code></pre>
</body>
</html>